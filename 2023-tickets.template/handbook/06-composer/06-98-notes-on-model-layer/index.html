
<!DOCTYPE html>

<html class="no-js" lang="ca">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.6" name="generator"/>
<title>Notes on model layer implementation - DWES</title>
<link href="../../assets/stylesheets/main.802231af.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="" data-md-color-primary="red" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#notes-on-model-layer-implementation">
          Salta el contingut
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DWES" class="md-header__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DWES
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Notes on model layer implementation
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Cerca" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Cerca" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DWES" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
    DWES
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Inici
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        1.- Introducció a la programació Web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="1.- Introducció a la programació Web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          1.- Introducció a la programació Web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/01-intro/">
        Estructura aplicacions web
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/02-developement/">
        Preparació de l'entorn de desenvolupament
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        2.- El llenguatge PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2.- El llenguatge PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          2.- El llenguatge PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/02-phpbasics/">
        PHP Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/99-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        3.- PHP Orientat a Objectes
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="3.- PHP Orientat a Objectes" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          3.- PHP Orientat a Objectes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0301-phpoo-basic/">
        PHP OO Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0302-phpoo-advanced/">
        PHP OO Avançat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0303-errorhandling/">
        Errors i excepcions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0399-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        4.- Programació web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="4.- Programació web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          4.- Programació web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-01-forms/">
        Formularis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-02-state/">
        Manteniment de l'estat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-03-authentication/">
        Autenticació
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-04-best-practices/">
        Bones pràctiques
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        5.- Accés a dades amb PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="5.- Accés a dades amb PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          5.- Accés a dades amb PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0500-intro/">
        Introducció
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0501-data-access/">
        Accés a dades amb PHP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0599-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="notes-on-model-layer-implementation">Notes on model layer implementation</h1>
<p>https://stackoverflow.com/questions/48805723/repository-and-data-mapper-coupling</p>
<ul>
<li>The db operations should be performed through adapters (MySqliAdapter, PdoAdapter, etc). So, the db connections are injected into adapters, not into the mappers. And certainly not in the repositories, because then the abstraction purpose of the repositories would be pointless.</li>
<li>A mapper receives adapter(s) as dependencies and can receive other mappers too.</li>
<li>The mappers are passed as dependencies to the repositories.</li>
<li>A repository name is semantically related to the domain layer names, not really to the ones of the service layer. E.g: "InputService": ok. "InputRepository": wrong. "CountryRepository": correct.</li>
<li>A service can receive more repositories. Or mappers, if you don't want to apply the extra layer of repositories.
  In the code, the only tightly coupled structure is the Country object (entity or domain object) - dynamically created for each fetched table row. Even this could be avoided through the use of a domain objects factory, but I, personally, don't see it really necessary.</li>
</ul>
<p>P.S: Sorry for not providing a more documented code.</p>
<p>Service</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">InputService</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$countryRepository</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nv">$productRepository</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">CountryRepositoryInterface</span> <span class="nv">$countryRepository</span><span class="p">,</span> <span class="nx">ProductRepositoryInterface</span> <span class="nv">$productRepository</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryRepository</span> <span class="o">=</span> <span class="nv">$countryRepository</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productRepository</span> <span class="o">=</span> <span class="nv">$productRepository</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInitialData</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$products</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">productRepository</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nv">$country</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryRepository</span><span class="o">-&gt;</span><span class="na">findByName</span><span class="p">(</span><span class="s1">'England'</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>        <span class="c1">//...</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>        <span class="k">return</span> <span class="c1">// resulted data</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="p">}</span>
</code></pre></div>
Repository</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">CountryRepository</span> <span class="k">implements</span> <span class="nx">CountryRepositoryInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$countryMapper</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">CountryMapperInterface</span> <span class="nv">$countryMapper</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span> <span class="o">=</span> <span class="nv">$countryMapper</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByPrefix</span><span class="p">(</span><span class="nv">$prefix</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">([</span><span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="nv">$prefix</span><span class="p">]);</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">([</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">]);</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="linenos" data-linenos="19 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">CountryInterface</span> <span class="nv">$country</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="22 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$country</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">CountryInterface</span> <span class="nv">$country</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="26 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryMapper</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$country</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="p">}</span>
</code></pre></div>
Data mapper</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">CountryMapper</span> <span class="k">implements</span> <span class="nx">CountryMapperInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$adapter</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">private</span> <span class="nv">$countryCollection</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">AdapterInterface</span> <span class="nv">$adapter</span><span class="p">,</span> <span class="nx">CountryCollectionInterface</span> <span class="nv">$countryCollection</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$adapter</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryCollection</span> <span class="o">=</span> <span class="nv">$countryCollection</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="k">array</span> <span class="nv">$filter</span> <span class="o">=</span> <span class="p">[],</span> <span class="nv">$one</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>        <span class="c1">// If $one is TRUE then add limit to sql statement, or so...</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nv">$bindings</span><span class="p">);</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>        <span class="c1">// If $one is TRUE return a domain object, else a domain objects list.</span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$one</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createCountry</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createCountryCollection</span><span class="p">(</span><span class="nv">$rows</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nx">CountryInterface</span> <span class="nv">$country</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="24 "></span>        <span class="k">if</span> <span class="p">(</span><span class="k">NULL</span> <span class="o">===</span> <span class="nv">$country</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="25 "></span>            <span class="c1">// Build the INSERT statement and the bindings array...</span>
<span class="linenos" data-linenos="26 "></span>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nv">$bindings</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>            <span class="nv">$lastInsertId</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">getLastInsertId</span><span class="p">();</span>
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">([</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$lastInsertId</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos="31 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span>        <span class="c1">// Build the UPDATE statement and the bindings array...</span>
<span class="linenos" data-linenos="34 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nv">$bindings</span><span class="p">);</span>
<span class="linenos" data-linenos="35 "></span>
<span class="linenos" data-linenos="36 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">([</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$country</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
<span class="linenos" data-linenos="37 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="38 "></span>
<span class="linenos" data-linenos="39 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">CountryInterface</span> <span class="nv">$country</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="40 "></span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s1">'DELETE FROM countries WHERE id=:id'</span><span class="p">;</span>
<span class="linenos" data-linenos="41 "></span>        <span class="nv">$bindings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">':id'</span> <span class="o">=&gt;</span> <span class="nv">$country</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">];</span>
<span class="linenos" data-linenos="42 "></span>
<span class="linenos" data-linenos="43 "></span>        <span class="nv">$rowCount</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="nv">$bindings</span><span class="p">);</span>
<span class="linenos" data-linenos="44 "></span>
<span class="linenos" data-linenos="45 "></span>        <span class="k">return</span> <span class="nv">$rowCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos" data-linenos="46 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="47 "></span>
<span class="linenos" data-linenos="48 "></span>    <span class="c1">// Create a Country (domain object) from row.</span>
<span class="linenos" data-linenos="49 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">createCountry</span><span class="p">(</span><span class="k">array</span> <span class="nv">$row</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
<span class="linenos" data-linenos="50 "></span>        <span class="nv">$country</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">();</span>
<span class="linenos" data-linenos="51 "></span>
<span class="linenos" data-linenos="52 "></span>        <span class="cm">/*</span>
<span class="linenos" data-linenos="53 "></span><span class="cm">         * Iterate through the row items.</span>
<span class="linenos" data-linenos="54 "></span><span class="cm">         * Assign a property to Country object for each item's name/value.</span>
<span class="linenos" data-linenos="55 "></span><span class="cm">         */</span>
<span class="linenos" data-linenos="56 "></span>
<span class="linenos" data-linenos="57 "></span>        <span class="k">return</span> <span class="nv">$country</span><span class="p">;</span>
<span class="linenos" data-linenos="58 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="59 "></span>
<span class="linenos" data-linenos="60 "></span>    <span class="c1">// Create a Country[] list from rows list.</span>
<span class="linenos" data-linenos="61 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">createCountryCollection</span><span class="p">(</span><span class="k">array</span> <span class="nv">$rows</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="62 "></span>        <span class="cm">/*</span>
<span class="linenos" data-linenos="63 "></span><span class="cm">         * Iterate through rows.</span>
<span class="linenos" data-linenos="64 "></span><span class="cm">         * Create a Country object for each row, with column names/values as properties.</span>
<span class="linenos" data-linenos="65 "></span><span class="cm">         * Push Country object object to collection.</span>
<span class="linenos" data-linenos="66 "></span><span class="cm">         * Return collection's content.</span>
<span class="linenos" data-linenos="67 "></span><span class="cm">         */</span>
<span class="linenos" data-linenos="68 "></span>
<span class="linenos" data-linenos="69 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countryCollection</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos="70 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="71 "></span>
<span class="linenos" data-linenos="72 "></span><span class="p">}</span>
</code></pre></div>
Db adapter</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">PdoAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$connection</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">PDO</span> <span class="nv">$connection</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span> <span class="o">=</span> <span class="nv">$connection</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$bindings</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">int</span> <span class="nv">$fetchMode</span> <span class="o">=</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">,</span> <span class="nv">$fetchArgument</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$fetchConstructorArguments</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$bindings</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="k">return</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nv">$fetchMode</span><span class="p">,</span> <span class="nv">$fetchArgument</span><span class="p">,</span> <span class="nv">$fetchConstructorArguments</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="c1">//...</span>
<span class="linenos" data-linenos="16 "></span><span class="p">}</span>
</code></pre></div>
Domain objects collection</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">CountryCollection</span> <span class="k">implements</span> <span class="nx">CountryCollectionInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">private</span> <span class="nv">$countries</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">push</span><span class="p">(</span><span class="nx">CountryInterface</span> <span class="nv">$country</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countries</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$country</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">all</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countries</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getIterator</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">return</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">countries</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    <span class="c1">//...</span>
<span class="linenos" data-linenos="19 "></span><span class="p">}</span>
</code></pre></div>
Domain object</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">Country</span> <span class="k">implements</span> <span class="nx">CountryInterface</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>    <span class="c1">// Business logic: properties and methods...</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span>
</code></pre></div>
<p>DataMapper is a layer to isolate an application from a concrete database. It transforms an object into a record of a database and a record into an object. DataMapper gives us the ability to work with Database and be unaware of what RDBMS we use. Example:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">interface</span> <span class="nx">DataMapperInterface</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">     * Find objects by a criteria</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos=" 7 "></span><span class="sd">     * @param array $criteria Search params</span>
<span class="linenos" data-linenos=" 8 "></span><span class="sd">     * @return Quote[] Found entities</span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="k">array</span> <span class="nv">$criteria</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">     * Insert an object into a database</span>
<span class="linenos" data-linenos="14 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="15 "></span><span class="sd">     * @param Quote $object Object that will be inserted</span>
<span class="linenos" data-linenos="16 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="17 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">insert</span><span class="p">(</span><span class="nx">Quote</span> <span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="20 "></span><span class="sd">     * Update an object date in a database</span>
<span class="linenos" data-linenos="21 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="22 "></span><span class="sd">     * @param Quote $object Object that will be updated</span>
<span class="linenos" data-linenos="23 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="24 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Quote</span> <span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="27 "></span><span class="sd">     * Remove an object from a database</span>
<span class="linenos" data-linenos="28 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="29 "></span><span class="sd">     * @param Quote $object Object that will be removed</span>
<span class="linenos" data-linenos="30 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="31 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">Quote</span> <span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="32 "></span><span class="p">}</span>
</code></pre></div>
Repository is a layer for encapsulation of logic of a query building. It gives us the ability to work with a collection of objects and be unaware to work with Database anything.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">class</span> <span class="nc">Repository</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd">    * @var DataMapperInterface Mapper to transform objects</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd">    */</span> 
<span class="linenos" data-linenos=" 7 "></span>   <span class="k">protected</span> <span class="nv">$mapper</span><span class="p">;</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">    * Constructor</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">    *</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">    * @param DataMapperInterface $mapper Mapper to transform objects</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="14 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">DataMapperInterface</span> <span class="nv">$mapper</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span> <span class="o">=</span> <span class="nv">$mapper</span><span class="p">;</span>
<span class="linenos" data-linenos="17 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="20 "></span><span class="sd">    * Find all objects</span>
<span class="linenos" data-linenos="21 "></span><span class="sd">    *</span>
<span class="linenos" data-linenos="22 "></span><span class="sd">    * @return Quote[] Found entities</span>
<span class="linenos" data-linenos="23 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="24 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">findAll</span><span class="p">()</span>
<span class="linenos" data-linenos="25 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="26 "></span>       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">([]);</span>
<span class="linenos" data-linenos="27 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="30 "></span><span class="sd">    * Find an object by an identifier</span>
<span class="linenos" data-linenos="31 "></span><span class="sd">    *</span>
<span class="linenos" data-linenos="32 "></span><span class="sd">    * @return Quote[] Found entities</span>
<span class="linenos" data-linenos="33 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="34 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nx">integer</span> <span class="nv">$id</span><span class="p">)</span>
<span class="linenos" data-linenos="35 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="36 "></span>       <span class="nv">$criteria</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">];</span>
<span class="linenos" data-linenos="37 "></span>       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$criteria</span><span class="p">);</span>
<span class="linenos" data-linenos="38 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="39 "></span>
<span class="linenos" data-linenos="40 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="41 "></span><span class="sd">    * Find objects by an author name</span>
<span class="linenos" data-linenos="42 "></span><span class="sd">    *</span>
<span class="linenos" data-linenos="43 "></span><span class="sd">    * @return Quote[] Found entities</span>
<span class="linenos" data-linenos="44 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="45 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">findByAuthor</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="linenos" data-linenos="46 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="47 "></span>       <span class="nv">$criteria</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'author'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">];</span>
<span class="linenos" data-linenos="48 "></span>       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$criteria</span><span class="p">);</span>
<span class="linenos" data-linenos="49 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="50 "></span>
<span class="linenos" data-linenos="51 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="52 "></span><span class="sd">    * Save an object into the repository</span>
<span class="linenos" data-linenos="53 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="54 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nx">Quote</span> <span class="nv">$object</span><span class="p">)</span>
<span class="linenos" data-linenos="55 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="56 "></span>       <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos="57 "></span>           <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="58 "></span>       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="59 "></span>           <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="60 "></span>       <span class="p">}</span>
<span class="linenos" data-linenos="61 "></span><span class="nx">a</span>    <span class="p">}</span>
<span class="linenos" data-linenos="62 "></span>
<span class="linenos" data-linenos="63 "></span>   <span class="sd">/**</span>
<span class="linenos" data-linenos="64 "></span><span class="sd">    * Remove an object from the repository</span>
<span class="linenos" data-linenos="65 "></span><span class="sd">    */</span>
<span class="linenos" data-linenos="66 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">Quote</span> <span class="nv">$object</span><span class="p">)</span>
<span class="linenos" data-linenos="67 "></span>   <span class="p">{</span>
<span class="linenos" data-linenos="68 "></span>       <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mapper</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
<span class="linenos" data-linenos="69 "></span>   <span class="p">}</span>
<span class="linenos" data-linenos="70 "></span><span class="p">}</span>
</code></pre></div>
<p>This is the very simple instance and all is more difficult in a real application: queries are bigger, repository can cooperate with many other patterns (Query Object to query building, Unit of Work to track changes, Identity Map to avoid repeatedly-load of objects, etc.)</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            2022-2023 Vicent Jordà - Licencia CC BY-NC-SA
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "C\u00f2pia al porta-retalls", "clipboard.copied": "Copiat al porta-retalls", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Cerca", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>