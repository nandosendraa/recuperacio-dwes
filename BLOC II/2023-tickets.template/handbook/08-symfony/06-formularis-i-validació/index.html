
<!DOCTYPE html>

<html class="no-js" lang="ca">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.6" name="generator"/>
<title>Generació de formularis i validació de dades - DWES</title>
<link href="../../assets/stylesheets/main.802231af.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="" data-md-color-primary="red" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#generacio-de-formularis-i-validacio-de-dades">
          Salta el contingut
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DWES" class="md-header__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DWES
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Generació de formularis i validació de dades
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Cerca" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Cerca" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DWES" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
    DWES
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Inici
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        1.- Introducció a la programació Web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="1.- Introducció a la programació Web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          1.- Introducció a la programació Web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/01-intro/">
        Estructura aplicacions web
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/02-developement/">
        Preparació de l'entorn de desenvolupament
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        2.- El llenguatge PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2.- El llenguatge PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          2.- El llenguatge PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/02-phpbasics/">
        PHP Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/99-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        3.- PHP Orientat a Objectes
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="3.- PHP Orientat a Objectes" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          3.- PHP Orientat a Objectes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0301-phpoo-basic/">
        PHP OO Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0302-phpoo-advanced/">
        PHP OO Avançat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0303-errorhandling/">
        Errors i excepcions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-phpoo/0399-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        4.- Programació web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="4.- Programació web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          4.- Programació web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-01-forms/">
        Formularis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-02-state/">
        Manteniment de l'estat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-03-authentication/">
        Autenticació
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-04-best-practices/">
        Bones pràctiques
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        5.- Accés a dades amb PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="5.- Accés a dades amb PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          5.- Accés a dades amb PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0500-intro/">
        Introducció
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0501-data-access/">
        Accés a dades amb PHP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0599-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="generacio-de-formularis-i-validacio-de-dades">Generació de formularis i validació de dades</h1>
<h2 id="generacio-de-formularis">Generació de formularis</h2>
<p>Fins a aquesta sessió hem après alguns conceptes útils de Symfony i
alguns dels seus <em>bundles</em> més destacats, com per exemple la generació de
vistes amb el motor de plantilles Twig, el desenvolupament de serveis, o
la comunicació amb la base de dades a través de l'ORM Doctrine. Hem fet
alguns controladors d'exemple per a cercar dades, o per a inserir.
Però, en aquest últim cas, al no disposar encara d'un mecanisme perquè
s'envien dades d'inserció des del client, hem optat ara com ara per
inserir unes dades prefixades, és a dir, una pel·lícula amb unes dades 
ja predefinides en el codi.</p>
<p>En aquesta sessió veurem de quina forma es poden definir formularis en
Symfony associats a una determinada entitat, perquè el que s'envie en
el formulari s'associe a un objecte d'aquesta entitat, i perquè puguem
pre­carregar el formulari amb les dades d'una entitat ja existent, amb
la finalitat de poder-los modificar.</p>
<h3 id="creacio-del-formulari-en-el-controlador">Creació del formulari en el controlador</h3>
<p>Els formularis poden crear-se fàcilment des de qualsevol controlador.
N'hi ha prou que creem o obtinguem l'objecte associat al formulari
(per exemple, una pel·lícula), i carreguem un formulari amb ell. En la
nostra aplicació de pel·lícules, anem a crear un nou controlador que
responga a la URI <code>/movies/create</code>, i que cree una pel·lícula buida i la mostre al
formulari.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">...</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\SubmitType</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">class</span> <span class="nc">MovieController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="linenos" data-linenos=" 6 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="o">...</span>
<span class="linenos" data-linenos=" 8 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 9 "></span><span class="sd">* @Route("/movies/create", name="movies_create")</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">*/</span>
<span class="linenos" data-linenos="11 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
<span class="linenos" data-linenos="12 "></span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nv">$movie</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Movie</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFormBuilder</span><span class="p">(</span><span class="nv">$movie</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'overview'</span><span class="p">,</span> <span class="nx">TextareaType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'releaseDate'</span><span class="p">,</span> <span class="nx">DateType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="18 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'poster'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="19 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="nx">SubmitType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Create'</span><span class="p">))</span>
<span class="linenos" data-linenos="20 "></span>        <span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>
<span class="linenos" data-linenos="21 "></span>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'create.html.twig'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
<span class="linenos" data-linenos="22 "></span>    <span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()));</span>
<span class="linenos" data-linenos="23 "></span><span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="o">...</span>
</code></pre></div>
Com podem veure, a través del <em>form builder</em> de Symfony es crea el
formulari. Després, afegim tants camps com a atributs tinga l'entitat
(normalment), associant cada atribut amb el seu camp pel nom.</p>
<p>En cada camp especifiquem també de quin tipus és. En el nostre cas, hem
definit tres quadres de text (<code>TextType</code>) per al títol, l'eslogan i el poster, 
un camp de data (<code>DateType</code>) per a la data de l'estrena, un camp (<code>TextareaType</code>) per 
a la sinopsi i un botó de submit (<code>SubmitType</code>) per a poder enviar el formulari. Podeu
consultar en <a href="https://symfony.com/doc/current/reference/forms/types.html">Form Types Reference</a> 
un llistat més detallat dels tipus de camps que tenim
disponibles. Alguns que poden resultar-nos interessants són:</p>
<ul>
<li><code>TextType</code> (quadres de text d'una sola línia, com l'exemple
    anterior)</li>
<li><code>TextareaType</code> (quadres de text de diverses línies)</li>
<li><code>EmailType</code> (quadres de text de tipus email)</li>
<li><code>IntegerType</code> (quadres de text per a nombres enters)</li>
<li><code>NumberType</code> (quadres de text per a nombres en general)</li>
<li><code>PasswordType</code> (quadres emmascarats per a passwords)</li>
<li><code>EntityType</code> (desplegables per a triar valors vinculats a una altra
    entitat)</li>
<li><code>DateType</code> (per a dates)</li>
<li><code>CheckboxType</code> (per a checkboxes)</li>
<li><code>RadioType</code> (per a botons de radi o radi buttons)</li>
<li><code>HiddenType</code> (per a controls ocults)</li>
<li>... etc.</li>
</ul>
<h4 id="etiquetes-personalitzades">Etiquetes personalitzades</h4>
<p>Com podem veure per al cas del botó de submit, podem especificar un
tercer paràmetre en el mètode <code>add</code> que és un array de propietats del
control en qüestió. Una d'elles és la propietat <code>label</code>, que ens permet
especificar quin text tindrà associat el control. Per defecte, s'associa
el nom de l'atribut corresponent en l'entitat, però podem canviar-ho
per un text personalitzat. Per a l'i­mail, per exemple, podríem posar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Correu</span>
<span class="linenos" data-linenos="2 "></span><span class="s1">        electrònic'</span><span class="p">))</span>
</code></pre></div>
<h4 id="millorant-el-nostre-formulari">Millorant el nostre formulari</h4>
<p>Aprofitant la varietat de tipus de camps que ofereix Symfony, anem a
millorar una mica el nostre formulari:</p>
<ul>
<li>Per al gènere que afegírem en la sessió de
    Doctrine, podem emprar un EntityType que prenga les seues dades de
    l'entitat <code>Genre</code>.</li>
</ul>
<p>Amb açò, el formulari quedaria així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>   <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'genre'</span><span class="p">,</span> <span class="nx">EntityType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span><span class="s1">'class'</span> <span class="o">=&gt;</span>
<span class="linenos" data-linenos="2 "></span>            <span class="nx">Genre</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">'choice_label'</span> <span class="o">=&gt;</span> <span class="s1">'name'</span><span class="p">])</span> <span class="o">...</span>
</code></pre></div>
<h3 id="renderitzant-el-formulari">Renderitzant el formulari</h3>
<p>El codi del controlador anterior acaba renderitzant una vista cridada
<code>create.html.twig</code> que, ara com ara, no existeix. En aquesta vista haurem de
renderizar el formulari. Podria quedar-se així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">'base.html.twig'</span> <span class="cp">%}</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Movies<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="linenos" data-linenos=" 4 "></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>New Movie<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="cp">{{</span> <span class="nv">form_start</span><span class="o">(</span><span class="nv">form</span><span class="o">)</span> <span class="cp">}}</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="cp">{{</span> <span class="nv">form_widget</span><span class="o">(</span><span class="nv">form</span><span class="o">)</span> <span class="cp">}}</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="cp">{{</span> <span class="nv">form_end</span><span class="o">(</span><span class="nv">form</span><span class="o">)</span> <span class="cp">}}</span>
<span class="linenos" data-linenos="10 "></span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</code></pre></div>
<p>Les tres línies sota l'encapçalat h1 són les responsables de
la renderización del formulari, a partir del paràmetre <code>form</code> que 
li passem des del controlador.</p>
<p>Si ara accedim a <code>http://movies-symfony/movies/create</code> podrem veure el
formulari:</p>
<p><img alt="form" src="../assets/form-movie.png"/></p>
<h3 id="emplenant-els-camps-del-formulari">Emplenant els camps del formulari</h3>
<p>Tornem al nostre nou controlador. Si construïm un objecte farcit amb
dades, veurem cada dada en el seu camp associat:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
<span class="linenos" data-linenos=" 2 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="nv">$movie</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Movie</span><span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="s2">" Groundhog Day"</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">setTagline</span><span class="p">(</span><span class="s2">"He’s having the worst </span>
<span class="linenos" data-linenos=" 6 "></span><span class="s2">        day of his life … over, and over …"</span><span class="p">);</span>      
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">setReleaseDate</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s2">"1993-05-07"</span><span class="p">));</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFormBuilder</span><span class="p">(</span><span class="nv">$movie</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span><span class="o">...</span>
</code></pre></div>
<h2 id="enviament-de-formularis">Enviament de formularis</h2>
<p>Parlem ara sobre com enviar el formulari. Per defecte, si no s'indica
gens, el formulari s'envia per POST a la mateixa URI que el genera (en
el nostre cas, a <code>movies/create</code>. De fet, si intentem enviar el formulari
en aquest moment, amb les dades que siguen, es tornarà a carregar la
vista del formulari, però no haurem inserit res.</p>
<p>Per a gestionar l'enviament d'aquestes dades, cal fer algunes
modificacions sobre el nostre controlador:</p>
<ul>
<li>En primer lloc, el controlador rebrà un objecte <code>Request</code>, que
    contindrà les dades del formulari enviat (en el cas que s'haja
    enviat)</li>
<li>En segon lloc, dins del codi del controlador, hem de processar
    aqueixes dades (si n'hi ha), validar-les (açò ho veurem a
    continuació) i si són vàlides, realitzar la corresponent inserció o
    modificació.</li>
<li>Finalment, podem redirigir a una altra ruta en cas d'èxit, o tornar
    a renderizar el formulari en cas d'error, o en cas que no s'haja
    enviat (per exemple, quan carreguem el formulari per a emplenar-ho).</li>
</ul>
<p>Unint aquestes premisses, el nostre controlador quedaria així:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># src/Controller/MovieController.php</span>
<span class="linenos" data-linenos=" 2 "></span>     <span class="sd">/**</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">     * @Route("/movies/create", name="movies_create")</span>
<span class="linenos" data-linenos=" 4 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="o">...</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="12 "></span>            <span class="nv">$movie</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>            <span class="nv">$entityManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDoctrine</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getManager</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>            <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$movie</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>            <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
<span class="linenos" data-linenos="16 "></span>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">'home'</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'movies_create.html.twig'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
<span class="linenos" data-linenos="19 "></span>            <span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()));</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span>    <span class="o">...</span>
<span class="linenos" data-linenos="22 "></span>    <span class="p">}</span>
</code></pre></div>
Si provem ara a carregar el formulari i realitzar una inserció, ens
enviarà a la pàgina d'inici, i podrem veure la nova pel·lícula en
la taula corresponent de la base de dades.</p>
<h3 id="modificacio-de-dades">Modificació de dades</h3>
<p>El que hem fet en l'exemple anterior és una inserció d'un nova
pel·lícula, però... com seria fer una modificació de pel·lícula existent?.
El funcionament seria molt similar, però amb un petit canvi: la ruta del
controlador rebrà com a paràmetre l'identificador de la pel·lícula a modificar, 
i a partir d'ací, cercaríem la pel·lícula i el carregaríem en el formulari,
incloent el seu <code>id</code> en un camp ocult. D'aquesta forma, en fer <code>persist</code>
es modificaria la pel·lícula existent.</p>
<p>Podem provar-ho amb aquest controlador:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>  <span class="sd">/**</span>
<span class="linenos" data-linenos=" 2 "></span><span class="sd">     * @Route("/movies/{id}/edit", name="movies_edit")</span>
<span class="linenos" data-linenos=" 3 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">edit</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="nv">$movieRepository</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDoctrine</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Movie</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="nv">$movie</span> <span class="o">=</span> <span class="nv">$movieRepository</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createFormBuilder</span><span class="p">(</span><span class="nv">$movie</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">HiddenType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="12 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'tagline'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'overview'</span><span class="p">,</span> <span class="nx">TextareaType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'releaseDate'</span><span class="p">,</span> <span class="nx">DateType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span>                <span class="p">[</span><span class="s1">'widget'</span> <span class="o">=&gt;</span> <span class="s2">"single_text"</span><span class="p">]</span>
<span class="linenos" data-linenos="16 "></span>            <span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'poster'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="18 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'genre'</span><span class="p">,</span> <span class="nx">EntityType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span>                <span class="p">[</span><span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Genre</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="20 "></span>                    <span class="s1">'choice_label'</span> <span class="o">=&gt;</span> <span class="s1">'name'</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span>                    <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'Select a genre'</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span>                <span class="p">]</span>
<span class="linenos" data-linenos="23 "></span>            <span class="p">)</span>
<span class="linenos" data-linenos="24 "></span>            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="nx">SubmitType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Create'</span><span class="p">))</span>
<span class="linenos" data-linenos="25 "></span>            <span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>
<span class="linenos" data-linenos="26 "></span>
<span class="linenos" data-linenos="27 "></span>        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span>       <span class="o">...</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Veiem que el codi és molt similar al de la inserció, excepte pel paràmetre
id que rep el controlador amb el codi de la pel·lícula a editar, la
cerca inicial d'aquesta película en la base de dades, i el camp ocult <code>id</code> en el formulari.</p>
<div class="alert-warning alert">
<p>Recorda que Symfony ens proporciona la possibilitat de fer <em>autowiring</em> de 
les entitats, afegint-les com a paràmetres en lloc del seu <code>id</code>.</p>
</div>
<p>Recorda afegir el corresponent use al principi perquè reconega la classe
<code>HiddenType</code>.</p>
<p>Ara, si accedim a <code>movies-symfony/movies/1/edit</code>, per exemple
(suposant que tinguem una pel·lícula amb id = 1 en la base de dades), es
carregarà el formulari amb les seues dades, i en enviar-lo, es
modificaran els camps que hàgem canviat, i es carregarà la pàgina
d'inici.</p>
<h2 id="validacio-de-formularis">Validació de formularis</h2>
<p>Ara que ja sabem crear, enviar i gestionar formularis, vegem un últim
pas, que seria la validació de dades d'aquests formularis prèvia al seu
enviament. En el cas de Symfony, la validació no s'aplica al formulari,
sinó a l'entitat subjacent (és a dir, a la classe <code>Movie</code>, en el nostre cas).</p>
<p>Per tant, la validació l'obtindrem afegint una sèrie de restriccions o
comprovacions a aquestes classes. Per exemple, per a indicar que el títol, 
el poster i la data de l'estrena no poden estar buits, afegim aquestes
anotacions en els atributs de la classe <code>Movie</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">#src/Entity/Movie.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="o">...</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="sd">/**</span>
<span class="linenos" data-linenos=" 5 "></span><span class="sd"> * @ORM\Entity(repositoryClass=MovieRepository::class)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="sd"> */</span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">Movie</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>   <span class="o">...</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">     * @ORM\Column(type="string", length=100)</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">     * @Assert\NotNull</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="13 "></span>    <span class="k">private</span> <span class="nv">$title</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="16 "></span><span class="sd">     * @ORM\Column(type="string", length=255, nullable=true)</span>
<span class="linenos" data-linenos="17 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">private</span> <span class="nv">$tagline</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="21 "></span><span class="sd">     * @ORM\Column(type="string", length=100)</span>
<span class="linenos" data-linenos="22 "></span><span class="sd">     * @Assert\NotNull</span>
<span class="linenos" data-linenos="23 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="24 "></span>    <span class="k">private</span> <span class="nv">$poster</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="27 "></span><span class="sd">     * @ORM\Column(type="date")</span>
<span class="linenos" data-linenos="28 "></span><span class="sd">     * @Assert\NotNull</span>
<span class="linenos" data-linenos="29 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="30 "></span>    <span class="k">private</span> <span class="nv">$releaseDate</span><span class="p">;</span>
<span class="linenos" data-linenos="31 "></span>    <span class="o">...</span>
</code></pre></div>
Perquè aquestes assercions s'activen caldrà desactivar la validació en el client
indicant que el formulari ha de tindre l'atribut <code>novalidate</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span># templates/movies-create.html.twig
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="cp">{{</span> <span class="nv">form_start</span><span class="o">(</span><span class="nv">form</span><span class="o">,</span> <span class="o">{</span><span class="nv">attr</span><span class="o">:</span> <span class="o">{</span><span class="s1">'novalidate'</span><span class="o">:</span> <span class="s1">'novalidate'</span><span class="cp">}}</span>) }}
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>Aquestes funcions de validació admeten una sèrie de paràmetres útils. Un
<span class="linenos" data-linenos=" 2 "></span>dels més útils és `message`, que s'empra per a determinar el missatge
<span class="linenos" data-linenos=" 3 "></span>d'error que mostrar a l'usuari en cas que la dada no siga vàlida. Per
<span class="linenos" data-linenos=" 4 "></span>exemple, per al títol, podem especificar aquest missatge d'error:
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span>```php
<span class="linenos" data-linenos=" 7 "></span>    /**
<span class="linenos" data-linenos=" 8 "></span>     * @ORM\Column(type="string", length=100)
<span class="linenos" data-linenos=" 9 "></span>     * @Assert\NotNull(message="The title is mandatory")
<span class="linenos" data-linenos="10 "></span>     */
<span class="linenos" data-linenos="11 "></span>    private $title;
</code></pre></div>
I es dispararà quan no inserim títol i intentem enviar el
formulari:</p>
<p>Podeu trobar més informació sobre quines assercions es poden usar per a
validar dades en la documentació oficial de Symfony: <a href="https://symfony.com/doc/current/validation.html">Validation</a>.</p>
<h2 id="altres-consideracions-finals">Altres consideracions finals</h2>
<p>Per a finalitzar aquesta sessió, vegem algunes qüestions que hem deixat
en el tinter i no deixen de ser igualment importants.</p>
<h3 id="creacio-de-classes-per-a-formularis">Creació de classes per a formularis</h3>
<p>Fins ara, hem definit els formularis directament en els controladors
afectats. Així, en el cas de l'aplicació de pel·lícules, hem definit un
formulari per a la ruta <code>/movies/create</code> i un altre (el mateix,
pràcticament) per a la ruta <code>/movies/{id}/edit</code>.</p>
<p>El recomanat, segons la documentació de Symfony, és no situar els
formularis directament en els controladors, sinó crear-los en una classe
a banda. D'aquesta forma, podríem reutilitzar els formularis en diversos
controladors, i no repetir codi innecessàriament.</p>
<p>Vegem com quedaria aquesta classe per al formulari d'inserció i edició
de pel·lícules. Com sempre, podem crear el formulari on vulguem, però per
unificar criteris, i seguint els exemples de la documentació de Symfony,
crearem una carpeta <code>Form</code> en la nostra carpeta <code>src</code>, i posarem dins els
formularis. En el nostre cas, crearem una classe anomenada <code>MovieType</code>,
que heretarà d'una classe base genèrica de Symfony cridada
<code>AbstractType</code>. Dins, definim el mètode <code>buildForm</code> que s'encarregarà de
crear el formulari, com fèiem abans en el mètode nou o a editar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># src/Form/MovieType.php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$builder</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'tagline'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'overview'</span><span class="p">,</span> <span class="nx">TextareaType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'releaseDate'</span><span class="p">,</span> <span class="nx">DateType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>                <span class="p">[</span><span class="s1">'widget'</span> <span class="o">=&gt;</span> <span class="s2">"single_text"</span><span class="p">]</span>
<span class="linenos" data-linenos="11 "></span>        <span class="p">)</span>
<span class="linenos" data-linenos="12 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'poster'</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'genre'</span><span class="p">,</span> <span class="nx">EntityType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="14 "></span>            <span class="p">[</span><span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Genre</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span>                <span class="s1">'choice_label'</span> <span class="o">=&gt;</span> <span class="s1">'name'</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span>                <span class="s1">'placeholder'</span> <span class="o">=&gt;</span> <span class="s1">'Select a genre'</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span>            <span class="p">]</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">)</span>
<span class="linenos" data-linenos="19 "></span>        <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="nx">SubmitType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Create'</span><span class="p">));</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
</code></pre></div>
<p>A més caldrà crear el mètode <code>configureOptions</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>   <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span>
<span class="linenos" data-linenos="2 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
<span class="linenos" data-linenos="4 "></span>            <span class="s1">'data_class'</span> <span class="o">=&gt;</span> <span class="nx">Movie</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="linenos" data-linenos="5 "></span>        <span class="p">]);</span>
<span class="linenos" data-linenos="6 "></span>    <span class="p">}</span>
</code></pre></div>
Ara, només ens queda reemplaçar el codi de crear el formulari en nou o
editar per l'ús d'aquesta nova classe:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># src/Controller/MovieController.php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$movie</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Movie</span><span class="p">();</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">MovieType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$movie</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="nv">$movie</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
<span class="linenos" data-linenos="11 "></span>        <span class="nv">$entityManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getDoctrine</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getManager</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>        <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$movie</span><span class="p">);</span>
<span class="linenos" data-linenos="13 "></span>        <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">'home'</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'movies_create.html.twig'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
<span class="linenos" data-linenos="17 "></span>        <span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()));</span>
<span class="linenos" data-linenos="18 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="afegint-estil-als-formularis">Afegint estil als formularis</h3>
<p>Els formularis que hem generat en aquesta sessió són molt funcionals,
però poc vistosos, ja que manquen d'estils CSS propis. Si volguérem
afegir CSS a aquests formularis, tenim diverses opcions.</p>
<p>Una opció rudimentària consisteix a afegir classes (atribut <code>class</code>) als
controls del formulari per a donar estils personalitzats. Després, en el
nostre CSS caldria indicar l'estil per a la classe en qüestió.</p>
<p>A més, Symfony ofereix diversos temes (<em>themes</em>) que podem aplicar als
formularis (i webs en general) per a donar-los una aparença general
basada en algun <em>framework</em> conegut, com Bootstrap o Foundation. Si volem
optar per l'aparença de Bootstrap, hem de fer el següent:</p>
<ol>
<li>
<p>Incloure la fulla d'estils CSS i l'arxiu Javascript de Bootstrap
    en les nostres plantilles. Una pràctica habitual és fer-ho en la
    plantilla <code>base.html.twig</code> perquè qualsevol que herete d'ella adopte
    aquest estil. Per a açò, en la secció <code>stylesheets</code> hem d'afegir el
    codi HTML que hi ha en la documentació oficial de Bootstrap per a incloure 
    la seua fulla d'estil, i en la secció javascripts els enllaços a les diferents 
    llibreries que s'indiquen en la documentació de Bootstrap també.</p>
</li>
<li>
<p>Editar l'arxiu de configuració <code>config/packages/twig.yaml</code> i indicar
    que els formularis usaran el tema de Bootstrap (en aquest cas,
    Bootstrap 5): 
    <div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nt">twig</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span> 
<span class="linenos" data-linenos="2 "></span>    <span class="l l-Scalar l-Scalar-Plain">form_themes</span><span class="p p-Indicator">:</span>
<span class="linenos" data-linenos="3 "></span>        <span class="p p-Indicator">[</span><span class="s">'bootstrap_5_layout.html.twig'</span><span class="p p-Indicator">]</span>
</code></pre></div></p>
</li>
</ol>
<p>Amb aquests dos canvis, l'aparença del nostre formulari de pel·lícules
queda així:</p>
<p><img alt="Form bootstrap" src="../assets/form-bootstrap-movies.png"/></p>
<p>Hi ha altres alternatives, com per exemple no indicar aquesta
configuració general en <code>config/packages/twig.yaml</code> i indicar formulari
per formulari el tema que es vol usar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">{%</span> <span class="k">form_theme</span> <span class="nv">form</span> <span class="s1">'bootstrap_5_layout.html.twig'</span> <span class="cp">%}</span> 
<span class="linenos" data-linenos="2 "></span>    <span class="cp">{{</span> <span class="nv">form_start</span><span class="o">(</span><span class="nv">form</span><span class="o">)</span> <span class="cp">}}</span> 
<span class="linenos" data-linenos="3 "></span>...
</code></pre></div>
<p>Existeixen també altres temes disponibles per a utilitzar. I també és possible
crear els teus propis. Podeu consultar més informació en 
<a href="https://symfony.com/doc/current/form/form_themes.html#symfony-built-in-form-themes">Symfony built-in form themes</a></p>
<h3 id="afegir-estils-per-a-les-validacions">Afegir estils per a les validacions</h3>
<p>En el cas de les validacions de dades del formulari, també podem definir
estils perquè els missatges que d'error que es mostren (paràmetre
message o similars en les anotacions de l'entitat) tinguen un estil
determinat. Açò s'aconsegueix fàcilment triant algun dels temes
predefinits de Symfony. </p>
<h2 id="exercicis">Exercicis</h2>
<h3 id="exercici-61">Exercici 6.1</h3>
<h4 id="movies">Movies</h4>
<p>Implementa el formulari d'inserció de pel·lícules seguient les indicacions</p>
<h4 id="projecte-personal">Projecte personal</h4>
<p>Implementa el formular d'inserció de la teua entitat principal, si té 
relacions també.</p>
<h3 id="exercici-62">Exercici 6.2</h3>
<h4 id="movies_1">Movies</h4>
<p>Partint del formulari anterior, crea el controlador d'edició de
pel·lícules. </p>
<h4 id="projecte-personal_1">Projecte personal</h4>
<p>Crea el formulari d'edició de l'entitat principal del teu projecte personal.</p>
<h3 id="exercici-63">Exercici 6.3</h3>
<h4 id="movies_2">Movies</h4>
<p>Anem a validar la classe <em>Movie</em> de la nostra aplicació de pel·lícules. Els
criteris de validació seran els següents:</p>
<ul>
<li>Cap camp pot ser null, llevat de l'eslògan (<em>tagline</em>). </li>
<li>El títol no podrà tindre una longitud superior a 100 caracters.</li>
</ul>
<h4 id="projecte-personal_2">Projecte personal</h4>
<p>Aplica la validació a l'entitat principal del teu projecte personal. </p>
<h3 id="exercici-64">Exercici 6.4</h3>
<h4 id="movies_3">Movies</h4>
<p>Crea la classe <code>MovieType.php</code> en el projecte de pel·lícules, on definiràs
el formulari per a inserció i edició de pel·lícules basant-te en el vist en 
el punt anterior.</p>
<p>Afegir l'estil de Bootstrap 4 al formulari de
pel·lícules.</p>
<h4 id="projecte-personal_3">Projecte personal</h4>
<p>Realitza en el teu projecte personal el mateix que has implementat en Movies.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            2022-2023 Vicent Jordà - Licencia CC BY-NC-SA
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "C\u00f2pia al porta-retalls", "clipboard.copied": "Copiat al porta-retalls", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Cerca", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>