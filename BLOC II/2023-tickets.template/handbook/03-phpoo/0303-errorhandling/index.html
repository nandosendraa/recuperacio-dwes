
<!DOCTYPE html>

<html class="no-js" lang="ca">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.6" name="generator"/>
<title>Errors i excepcions - DWES</title>
<link href="../../assets/stylesheets/main.802231af.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="" data-md-color-primary="red" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#gestio-derrors-i-excepcions">
          Salta el contingut
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DWES" class="md-header__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DWES
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Errors i excepcions
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Cerca" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Cerca" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DWES" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="DWES">
<img alt="logo" src="../../assets/logo.png"/>
</a>
    DWES
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Inici
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
        1.- Introducció a la programació Web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="1.- Introducció a la programació Web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          1.- Introducció a la programació Web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/01-intro/">
        Estructura aplicacions web
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/02-developement/">
        Preparació de l'entorn de desenvolupament
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-intro/99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
        2.- El llenguatge PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2.- El llenguatge PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          2.- El llenguatge PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/02-phpbasics/">
        PHP Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-basics/99-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        3.- PHP Orientat a Objectes
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="3.- PHP Orientat a Objectes" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          3.- PHP Orientat a Objectes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../0301-phpoo-basic/">
        PHP OO Bàsic
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0302-phpoo-advanced/">
        PHP OO Avançat
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Errors i excepcions
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Errors i excepcions
      </a>
<nav aria-label="Taula de continguts" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#errors">
    Errors
  </a>
<nav aria-label="Errors" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#canviar-el-comportament-de-php">
    Canviar el comportament de PHP
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#notificacio-derror-en-entorns-de-produccio">
    Notificació d'error en entorns de producció
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gestio-global-dels-errors">
    Gestió global dels errors
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#errorexception">
    ErrorException
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#excepcions">
    Excepcions
  </a>
<nav aria-label="Excepcions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#el-bloc-finally">
    El bloc finally
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#multiples-catch">
    Múltiples catch
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ampliant-les-excepcions">
    Ampliant les excepcions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#interficie-throwable">
    Interfície Throwable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bibliografia">
    Bibliografia
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../0399-activities/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        4.- Programació web
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="4.- Programació web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          4.- Programació web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-01-forms/">
        Formularis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-02-state/">
        Manteniment de l'estat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-03-authentication/">
        Autenticació
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-04-best-practices/">
        Bones pràctiques
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-web-programming/04-99-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        5.- Accés a dades amb PHP
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="5.- Accés a dades amb PHP" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          5.- Accés a dades amb PHP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0500-intro/">
        Introducció
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0501-data-access/">
        Accés a dades amb PHP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-data-access/0599-tasks/">
        Activitats
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="gestio-derrors-i-excepcions">Gestió d'errors i excepcions</h1>
<p>De ben segur que a mesura que has anat resolent exercicis o simplement
provant codi, t'has trobat amb errors de programació. Alguns són
reconeguts per l'entorn de desenvolupament i pots corregir-los abans
d'executar. Altres apareixen al navegador en forma de missatge d'error a
l'executar l'<em>script</em>.</p>
<p>A diferència d'altres llenguatges de programació que tenen una gestió d'excepcions
més completa PHP manté una gestió d'excepcions lleugera ja que distingeix entre errors i excepcions. 
Així, mentre no es produisca una excepció o un error fatal l'execució del programa continuarà.</p>
<p>No obstant això, en PHP 7 canvia la majoria dels errors notificats per PHP. En lloc de notificar errors a través 
de l'mecanisme de notificació d'errors tradicional de PHP 5, la majoria dels errors ara són
 notificats llançant excepcions <code>Error</code>.</p>
<p>A l'igual que les excepcions normals, les excepcions <code>Error</code> es propagaran fins a arribar al
primer bloc <code>catch</code> coincident. Si no hi ha blocs coincidents, serà invocat qualsevol 
gestor d'excepcions predeterminat definit amb <code>set_exception_handler ()</code>, i si no hi hagués 
cap gestor d'excepcions predeterminat, l'excepció serà convertida en un error fatal i serà gestionada 
com un error tradicional.</p>
<p>A causa de que la jerarquia d'<code>Error</code> no hereta de <code>Exception</code>, el codi que empre blocs <code>catch 
(Exception $e) {...}</code> per gestionar excepcions no capturades en PHP 5 trobareu que 
aquests <code>Errors</code> no són capturats per aquests blocs. Es requereix, per tant, un bloc 
<code>catch (Error $e) {...}</code> o un gestor <code>set_exception_handler()</code>.</p>
<h2 id="errors">Errors</h2>
<p>PHP defineix una classificació dels errors que es poden produir en
l'execució d'un programa i ofereix mètodes per ajustar el tractament
dels mateixos. Per fer referència a cada un dels nivells d'error, PHP
defineix una sèrie de constants. Cada nivell s'identifica per una
constant. Per exemple, la constant <code>E_NOTICE</code> fa referència a avisos que
poden indicar un error en executar el programa, i la constant <code>E_ERROR</code>
engloba errors fatals que provoquen que s'interrompa forçosament l'execució.</p>
<p>La llista completa de constants la pots consultar al manual de PHP, on
també es descriu el tipus d'errors que representa :
<a href="http://es.php.net/manual/es/errorfunc.constants.php">http://es.php.net/manual/es/errorfunc.constants.php</a></p>
<h3 id="canviar-el-comportament-de-php">Canviar el comportament de PHP</h3>
<p>La configuració inicial de com va a tractar-se cada error segons el seu
nivell es realitza en <code>php.ini</code> el fitxer de configuració de PHP. Entre
els principals paràmetres que pots ajustar estan:</p>
<ul>
<li><code>error_reporting</code>. Indica quins tipus d'errors es notificaran. El
    seu valor es forma utilitzant els operadors a nivell de bit per
    combinar les constants anteriors. El seu valor per defecte és <code>E_ALL
    &amp; ~ E_NOTICE</code> que indica que es notifiquin tots els errors (<code>E_ALL</code>)
    excepte els avisos a temps d'execució (<code>E_NOTICE</code>).</li>
<li><code>display_errors</code>. En el seu valor per defecte (<code>On</code>), fa que els
    missatges s'envien a la sortida estàndard (i per tant es mostrin al
    navegador). S'ha de desactivar (<code>Off</code>) en els servidors que s'usen per 
    a producció.</li>
</ul>
<p>Hi ha altres paràmetres que podem utilitzar en <code>php.ini</code> per ajustar el
comportament de PHP quan es produeix un error.
<a href="http://es.php.net/manual/es/errorfunc.configuration.php">http://es.php.net/manual/es/errorfunc.configuration.php</a></p>
<p>Des codi, pots fer servir la funció <code>error_reporting</code> amb les constants
anteriors per establir el nivell de notificació en un moment determinat.
Per exemple, si en algun lloc del teu codi figura una divisió en la qual
hi haja la possibilitat que el divisor siga zero, quan això passe
obtindràs un missatge d'error al navegador. Per evitar-ho, pots
desactivar la notificació de errors de nivell <code>E_WARNING</code> abans de la
divisió i restaurar al seu valor normal a continuació:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="nx">E_NOTICE</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="k">E_WARNING</span><span class="p">);</span>
<span class="linenos" data-linenos="2 "></span><span class="nv">$resultat</span> <span class="o">=</span> <span class="nv">$dividend</span><span class="o">/</span><span class="nv">$divisor</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="nb">error_reporting</span> <span class="p">(</span><span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="nx">E_NOTICE</span><span class="p">);</span>
</code></pre></div>
<h3 id="notificacio-derror-en-entorns-de-produccio">Notificació d'error en entorns de producció</h3>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1">; PHP comes packaged with two INI files. One that is recommended to be used</span>
<span class="linenos" data-linenos=" 2 "></span><span class="c1">; in production environments and one that is recommended to be used in</span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1">; development environments.</span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1">; php.ini-production contains settings which hold security, performance and</span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1">; best practices at its core. But please be aware, these settings may break</span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1">; compatibility with older or less security conscience applications. We</span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1">; recommending using the production ini in production and testing environments.</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1">; display_errors</span>
<span class="linenos" data-linenos="10 "></span><span class="c1">;   Default Value: On</span>
<span class="linenos" data-linenos="11 "></span><span class="c1">;   Development Value: On</span>
<span class="linenos" data-linenos="12 "></span><span class="c1">;   Production Value: Off</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="c1">; display_startup_errors</span>
<span class="linenos" data-linenos="15 "></span><span class="c1">;   Default Value: Off</span>
<span class="linenos" data-linenos="16 "></span><span class="c1">;   Development Value: On</span>
<span class="linenos" data-linenos="17 "></span><span class="c1">;   Production Value: Off</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="c1">; error_reporting</span>
<span class="linenos" data-linenos="20 "></span><span class="c1">;   Default Value: E_ALL &amp; ~E_NOTICE &amp; ~E_STRICT &amp; ~E_DEPRECATED</span>
<span class="linenos" data-linenos="21 "></span><span class="c1">;   Development Value: E_ALL</span>
<span class="linenos" data-linenos="22 "></span><span class="c1">;   Production Value: E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="c1">; html_errors</span>
<span class="linenos" data-linenos="25 "></span><span class="c1">;   Default Value: On</span>
<span class="linenos" data-linenos="26 "></span><span class="c1">;   Development Value: On</span>
<span class="linenos" data-linenos="27 "></span><span class="c1">;   Production value: On</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="c1">; log_errors</span>
<span class="linenos" data-linenos="30 "></span><span class="c1">;   Default Value: Off</span>
<span class="linenos" data-linenos="31 "></span><span class="c1">;   Development Value: On</span>
<span class="linenos" data-linenos="32 "></span><span class="c1">;   Production Value: On</span>
</code></pre></div>
<h3 id="gestio-global-dels-errors">Gestió global dels errors</h3>
<p>En utilitzar la funció <code>error_reporting</code> només controles quin tipus
d'errors va a notificar PHP. A vegades pot ser suficient, però per
obtenir més control sobre el procés existeix també la possibilitat de
gestionar de forma personalitzada els errors. És a dir, pots programar
una funció perquè siga la que executa PHP cada vegada que es produeix un
error. El nom d'aquesta funció s'indica utilitzant <code>set_error_handler</code> i
ha de tenir com a mínim dos paràmetres obligatoris (el nivell de l'error
i el missatge descriptiu) i fins tres opcionals amb informació addicional 
sobre el error (el nom del fitxer en què es produeix, el nombre de línia, 
i un bolcat de l'estat de les variables en aquest moment).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nb">set_error_handler</span> <span class="p">(</span><span class="s2">"miGestorDeErrores"</span><span class="p">);</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$resultat</span> <span class="o">=</span> <span class="nv">$dividend</span> <span class="o">/</span> <span class="nv">$divisor</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="nb">restore_error_handler</span> <span class="p">();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">function</span> <span class="nf">miGestorDeErrores</span> <span class="p">(</span><span class="nv">$nivell</span><span class="p">,</span> <span class="nv">$missatge</span><span class="p">)</span>
<span class="linenos" data-linenos=" 5 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">switch</span> <span class="p">(</span><span class="nv">$nivell</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">case</span> <span class="k">E_WARNING</span><span class="o">:</span>
<span class="linenos" data-linenos=" 8 "></span>          <span class="k">echo</span> <span class="s2">"Error de tipus WARNING: </span><span class="si">$missatge</span><span class="s2">. &lt;br /&gt;"</span><span class="p">;</span>
<span class="linenos" data-linenos=" 9 "></span>          <span class="k">break</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">default</span><span class="o">:</span>
<span class="linenos" data-linenos="11 "></span>          <span class="k">echo</span> <span class="s2">"Error de tipus no especificat: $ missatge. &lt;br /&gt;"</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<p>La funció <code>restore_error_handler</code> restaura el gestor d'errors original
de PHP (més concretament, el que s'estava fent servir abans de la crida
a <code>set_error_handler</code>).</p>
<h3 id="errorexception">ErrorException</h3>
<p>Gràcies a la combinació de la classe <code>ErrorException</code> i el mètode <code>set_error_handler</code> 
podem convertir fàcilment els errors en excepcions de tipus <code>ErrorException</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="k">function</span> <span class="nf">exception_error_handler</span><span class="p">(</span><span class="nv">$severidad</span><span class="p">,</span> <span class="nv">$mensaje</span><span class="p">,</span> <span class="nv">$fichero</span><span class="p">,</span> <span class="nv">$línea</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">error_reporting</span><span class="p">()</span> <span class="o">&amp;</span> <span class="nv">$severidad</span><span class="p">))</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="c1">// Este código de error no está incluido en error_reporting</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">return</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">ErrorException</span><span class="p">(</span><span class="nv">$mensaje</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$severidad</span><span class="p">,</span> <span class="nv">$fichero</span><span class="p">,</span> <span class="nv">$línea</span><span class="p">);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nb">set_error_handler</span><span class="p">(</span><span class="s2">"exception_error_handler"</span><span class="p">);</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="cm">/* Desencadenar la excepción */</span>
<span class="linenos" data-linenos="12 "></span><span class="nb">strpos</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span><span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h2 id="excepcions">Excepcions</h2>
<p>A partir de la versió 5 es va introduir en PHP un model d'excepcions
similar a l'existent en altres llenguatges de programació:</p>
<ul>
<li>El codi susceptible de produir algun error s'introdueix en un bloc
    <code>try</code>.</li>
<li>Quan es produeix algun error, es llança una excepció utilitzant la
    instrucció <code>throw</code>.</li>
<li>Després del bloc <code>try</code> ha d'haver com a mínim un bloc <code>catch</code>
    encarregat de processar el error.</li>
<li>Si un cop acabat el bloc <code>try</code> no s'ha llançat cap excepció, es
    continua amb la execució en la línia següent al bloc o blocs
    <code>catch</code>.</li>
</ul>
<p>Per exemple, per llançar una excepció quan es produeix una divisió per
zero podries fer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>   <span class="k">if</span> <span class="p">(</span><span class="nv">$divisor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos" data-linenos="3 "></span>      <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span> <span class="p">(</span> <span class="s2">"Divisió per zero."</span><span class="p">);</span>
<span class="linenos" data-linenos="4 "></span>   <span class="nv">$resultat</span> <span class="o">=</span> <span class="nv">$dividend</span><span class="o">/</span><span class="nv">$divisor</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="7 "></span>   <span class="k">echo</span> <span class="s2">"S'ha produït el següent error:"</span><span class="o">.</span> <span class="err">$</span> <span class="nx">e</span><span class="o">-&gt;</span> <span class="na">getMessage</span> <span class="p">();</span>
<span class="linenos" data-linenos="8 "></span><span class="p">}</span>
</code></pre></div>
<p>PHP ofereix una classe base <code>Exception</code> per utilitzar com a gestor
d'excepcions. Per llançar una excepció no cal indicar cap paràmetre,
encara que de forma opcional es pot passar un missatge d'error (com en
l'exemple anterior) i també un codi d'error.</p>
<p>Entre els mètodes que podeu utilitzar amb els objectes de la classe
<code>Exception</code> estan:</p>
<ul>
<li><code>getMessage</code>. Retorna el missatge, en cas que s'hagi posat algun.</li>
<li><code>getCode</code>. Retorna el codi d'error si existeix.</li>
</ul>
<p>Les funcions internes de PHP i moltes extensions com MySQLi usen el
sistema d'errors vist anteriorment. Només les extensions més modernes
orientades a objectes, com és el cas de PDO, utilitzen aquest model
d'excepcions. En aquest cas, el més comú és que l'extensió definisca els
seues propis controladors d'errors heretant de la classe <code>Exception</code>.</p>
<div class="admonition information">
<p class="admonition-title">Classe ErrorException</p>
<p>Com hem dit abans, utilitzant la classe <code>ErrorException</code> és possible traduir els errors a
excepcions.<a href="http://es.php.net/manual/es/class.errorexception.php">http://es.php.net/manual/es/class.errorexception.php</a></p>
</div>
<p>Concretament, la classe PDO permet definir la fórmula que farà servir
quan es produeixi un error, utilitzant l'atribut <code>PDO::ATTR_ERRMODE</code>.
Les possibilitats són:</p>
<ul>
<li><code>PDO::ERRMODE_SILENT</code>. No es fa res quan ocorre un error. És el
    comportament per defecte.</li>
<li><code>PDO::ERRMODE_WARNING</code>. Genera un error de tipus E_WARNING quan es
    produeix un error.</li>
<li><code>PDO::ERRMODE_EXCEPTION</code>. Quan es produeix un error llança una
    excepció utilitzant el gestor propi PDOException.</li>
</ul>
<p>És a dir, que si vols utilitzar excepcions amb l'extensió PDO, has de
configurar la connexió fent:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nv">$dwes</span><span class="o">-&gt;</span> <span class="na">setAttribute</span> <span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</code></pre></div>
<p>Per exemple, el següent codi:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="nv">$dwes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:host=localhost;dbname=dwes"</span><span class="p">,</span> <span class="s2">"dwes"</span><span class="p">,</span> <span class="s2">"abc123."</span><span class="p">);</span>
<span class="linenos" data-linenos=" 2 "></span><span class="nv">$dwes</span><span class="o">-&gt;</span> <span class="na">setAttribute</span> <span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT * FROM stox"</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dwes</span><span class="o">-&gt;</span><span class="na">query</span> <span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="o">...</span>
<span class="linenos" data-linenos=" 7 "></span><span class="p">}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$p</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">echo</span> <span class="s2">"Error"</span><span class="o">.</span> <span class="nv">$p</span><span class="o">-&gt;</span> <span class="na">getMessage</span> <span class="p">()</span><span class="o">.</span> <span class="s2">"&lt;br /&gt;"</span><span class="p">;</span>
<span class="linenos" data-linenos="10 "></span><span class="p">}</span>
</code></pre></div></p>
<p>Captura l'excepció que llança PDO a causa de que la taula no existeix.
El bloc <code>catch</code> mostra el següent missatge:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">Error</span> <span class="nx">SQLSTATE</span> <span class="p">[</span><span class="mi">42</span><span class="nx">S02</span><span class="p">]</span><span class="o">:</span> <span class="nx">Base</span> <span class="nx">table</span> <span class="k">or</span> <span class="nx">view</span> <span class="k">not</span> <span class="nx">found</span><span class="o">:</span> <span class="mi">1146</span> <span class="nx">Table</span> <span class="s1">'dwes.stox'</span> <span class="nx">does</span> <span class="k">not</span> <span class="nx">exist</span>
</code></pre></div>
<h3 id="el-bloc-finally">El bloc <code>finally</code></h3>
<p>En PHP 5.5 i posterior, es pot utilitzar un bloc <code>finally</code> després o en
lloc dels blocs <code>catch</code>. El codi de dins el bloc <code>finally</code> sempre
s'executarà després dels blocs <code>try</code> i <code>catch</code>, independentment que
s'haja llançat una excepció o no, i abans que l'execució normal
continue.</p>
<p>Com que el contingut del bloc <code>finally</code> sempre s'executa és ideal per a
alliberar recursos en cas d'error, com una connexió a base de dades o a
la connexió a un servei proporcionats per tercers.<code></code></p>
<h3 id="multiples-catch">Múltiples catch</h3>
<p>És possible afegir més d'un <code>cath</code> de la següent manera:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>   <span class="o">...</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">FooException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>   <span class="o">...</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">BarException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span>   <span class="o">...</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="8 "></span>   <span class="o">...</span>   
<span class="linenos" data-linenos="9 "></span><span class="p">}</span>
</code></pre></div>
<p>A partir de PHP 7.1 també és possible fer-ho així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>   <span class="o">...</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">FooException</span> <span class="o">|</span> <span class="nx">BarException</span> <span class="o">|</span> <span class="nx">Exception</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>   <span class="o">...</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span>
</code></pre></div>
<h2 id="ampliant-les-excepcions">Ampliant les excepcions</h2>
<p>És possible crear excepcions personalitzades heretant de la classe
<code>Exception</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">class</span> <span class="nc">NegativeIdException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>  <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$message</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="3 "></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="nv">$message</span> <span class="o">?:</span> <span class="s1">'ID Negatiu.'</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="linenos" data-linenos="5 "></span>  <span class="p">}</span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span>
</code></pre></div>
<p>Després l'utilitzarem així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-linenos="2 "></span>  <span class="nv">$post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"Hola món"</span><span class="p">,</span> <span class="s2">"Aquest és el primer post del blog"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(),</span> <span class="s2">"Vicent"</span><span class="p">);</span>
<span class="linenos" data-linenos="3 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">NegativeIdException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="4 "></span>    <span class="k">echo</span> <span class="s2">"No es pot posar un ID negatiu"</span><span class="p">;</span>
<span class="linenos" data-linenos="5 "></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="6 "></span>  <span class="k">echo</span> <span class="s2">"Excepció desconeguda"</span><span class="o">.</span>  <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="linenos" data-linenos="7 "></span><span class="p">}</span>
</code></pre></div>
<p>Les excepcions personalitzades ens permeten una gestió més senzilla dels errors i major flexibilitat a l'hora de gestionar
les possibles situacions d'errors.</p>
<h2 id="interficie-throwable">Interfície Throwable</h2>
<p><em>Throwable</em> és la interfície base per a qualsevol objecte que puga ser llançat 
mitjançant una sentència <code>throw</code> en PHP 7, incloent <code>Error</code> i <code>Exception</code>.</p>
<p>Les classes de PHP no poden implementar la interfície <code>Throwable</code> directament, 
de manera que han d'estendre en el seu lloc <code>Exception</code>.</p>
<p>Aquesta nova interfície té per objectiu unificar les dos tipologies d'exceptions. Tant <code>Exception</code> com 
<code>Error</code> implementen la interfície <code>Throwable</code>. </p>
<h2 id="bibliografia">Bibliografia</h2>
<ul>
<li>José Luis Comesaña.  <em>Apuntes de formación a distancia del módulo
    «Desarrollo web en entorno servidor» del CFGS DAW, elaborados y
    licenciados por el Ministerio de Educación, Cultura y Deporte.</em> [en
    línia]. 2012 [data de consulta: 13 de setembre de 2019].
    Disponible en
    \&lt;<a href="https://github.com/statickidz/TemarioDAW/tree/master/DWES">https://github.com/statickidz/TemarioDAW/tree/master/DWES</a>&gt;</li>
<li>Antonio López. <em>Learning PHP 7.</em> Packt Publishing (29 de marzo de
    2016) .</li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Anterior: PHP OO Avançat" class="md-footer__link md-footer__link--prev" href="../0302-phpoo-advanced/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Anterior
              </span>
              PHP OO Avançat
            </div>
</div>
</a>
<a aria-label="Següent: Activitats" class="md-footer__link md-footer__link--next" href="../0399-activities/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Següent
              </span>
              Activitats
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            2022-2023 Vicent Jordà - Licencia CC BY-NC-SA
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "C\u00f2pia al porta-retalls", "clipboard.copied": "Copiat al porta-retalls", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Cerca", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>